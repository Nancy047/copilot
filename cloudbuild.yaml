steps:
  - name: 'gcr.io/cloud-builders/docker'
    id: 'Build Docker Image'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/copilotui', '.']

  - name: 'gcr.io/cloud-builders/docker'
    id: 'Docker Push'
    args: ["push", "gcr.io/$PROJECT_ID/copilotui"]

  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args: 
      - '-c'
      - 'sed -i "s|image:.*|image: us-central1-docker.pkg.dev/lumen-b-ctl-047/b-ctl-047-artifact/copilot-bot:83d61b8987ed50602127c81ea71d1e1d5a209ac4|g" deployment.yaml'

  - name: 'gcr.io/cloud-builders/gke-deploy'
    args: ['apply', '--filename=deployment.yaml', '--namespace=default', '--cluster=b-ctl-dev-cluster', '--location=us-central1-c']
