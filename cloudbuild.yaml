steps:
  - name: 'gcr.io/cloud-builders/docker'
    id: 'Build Docker Image'
    args: ['build','-t','gcr.io/lumen-b-ctl-047/cloudbuild','.']

  - name: 'gcr.io/cloud-builders/docker'
    id: 'Docker Push'
    args: ["push", "gcr.io/lumen-b-ctl-047/cloudbuild"]

  - name: 'gcr.io/cloud-builders/gke-deploy'
    id: 'Prepare deploy'
    args:
      - 'prepare'
      - '--image=gcr.io/lumen-b-ctl-047/cloudbuild'
      - '--app=cloudbuild'
      - '--namespace=default'
      - '--output=output'

  - name: 'gcr.io/cloud-builders/gke-deploy'
    id: 'Apply deploy'
    args:
      - 'apply'
      - '--filename=deployment.yaml'
      - '--namespace=default'
      - '--cluster=b-ctl-dev-cluster'
      - '--location=us-central1-c'


timeout: 2200s
images: ['gcr.io/lumen-b-ctl-047/cloudbuild']